#! /bin/bash

####################################################
#
#   A Script to lock down SSH undocumented function
#     BUG Origination ~2016_01_13
#   Written by Joel E White
#     2016_01_14
#
# OpenSSH Client Bug CVE-2016-0777 and CVE-2016-0778
#####################################################

echo
echo "Locking down UseRoaming - undocumented function until a formal patch has been issued"

EXISTS=`cat /etc/ssh/ssh_config | grep UseRoaming | wc -l`

function EXISTS() {
  if [[ ${EXISTS} -lt 1 ]]
    then
      echo "This system does not have the value for UseRoaming Set properly"
    else
      echo "This system already has the value of no set for UseRoaming"
      exit
  fi
}

function PATCH() {
  echo 'UseRoaming no' | sudo tee -a /etc/ssh/ssh_config
  echo
  echo "Verifying the change took place....  cat /etc/ssh/ssh_config | grep UseRoaming"
  cat /etc/ssh/ssh_config | grep UseRoaming
}

#### RUNNING THE DEFINED FUNCTIONS
EXISTS
PATCH
